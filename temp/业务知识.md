# 层序实现

学长，那个层次布局我看了下源码。3d-force-graph的dag层次布局中各个小球之间的间距其实是可以通过d3-force-3d.forceCollide力调整的，调整之后小球就不会那么密集了。但是现在有个问题就是我测了下dev_type为16和17的数据，发现是有环情况存在的。我想问下学长你就是联通那边到时候要进行层次布局的数据也是有环存在的吗？如果是存在环的，那该怎么进行层次布局呢，比如A，B两个节点，A指向B，B指向A，这时候谁在上一层呢？

**对了，环是个比较麻烦的问题，我印象中，按照他内置的布局算法，是不允许存在环的情形的，否则就会报错**

**但是实际上，联通那边的数据非常复杂，确实是有环的形式存在**

**当时也测试了一段时间，没有解决环这个问题，所以最后在项目中，基本没有使用层级布局**

**现在你也碰到这个问题了是吧**

是的 我只测了dev_type为16和17的数据 就发现了问题了。。

**我感觉如果要解决这种环的问题，只有一个途径，就是做下数据预处理，强制过滤一遍数据，把环去掉**

**至于谁指向谁这个问题，不同层级还可以区分一下，如果是同一层级的话，没法区分谁指向谁了**

那这种情况的话，过滤规则是不是得联通那边指定？就是说将实际数据的层级关系和人为规定的层级关系分开，只考虑人为规定的层级？

**对，过滤规则就得按业务来指定了，比如1，2，3三个设备类型，1是最高层级，2是中间，3是最低，那肯定就是统一成1指向2，2指向3这种逻辑**

**这个倒也好办，就假设预留一个数据处理接口，预处理完的数据是没有环的，应该就可以应用层级布局了**

**另外一种层级布局的思路，就是不采用默认的层级布局算法，直接再实现一套，根据手动指定位置的层级算法，这种就不用担心环的问题了**

**手动指定位置，是不怕有环的**

手动指定位置的话，是指用户在输入的时候就已经将各个节点在哪一层规定好了吗？

**根据输入的节点属性去判断，比如根据dev_type来判断在哪一层**

**参照这个逻辑**

```
对，过滤规则就得按业务来指定了，比如1，2，3三个设备类型，1是最高层级，2是中间，3是最低，
那肯定就是统一成1指向2，2指向3这种逻辑
```

**规则算是制定好了，hardcode到算法里**

恩恩 好的 我再想想这两种思路 还有就是哪些数据需要实现层级布局呢？比如说某几个级别的数据，如某几个dev_type或者某几个dev_role这种？

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c281a723-6dc5-4418-b9e8-3f597f0c9125/Untitled.png)

**举个例子哈**

**目前涉及到的应用，主要是通过dev_net、dev_type这两个字段来定位层级的**

**第一个层级是dev_net，代表网络类型，由高到底依次是
169骨干网 - 4
承载A网 - 8
IP城域网 - 1
智能城域网 - 11
从上边这个图例也能大概看出他们的层级和位置**

**第二个层级，就是同一个网内的dev_type了
比如骨干网（4），可能有好多不同的dev_type，可以根据这些dev_type，排出个顺序来，按层级高低展示**

**大概层级的话，就是这么个逻辑，当然中间还有好多细节，你其实可以不用考虑，你可以考虑的是，这样一个算法：
输入是一堆节点，以及节点的属性（比如dev_net和dev_type），然后假设已经有了层级规则，如何根据这些已知的信息，输出所有节点合理的位置信息**

dev_net和dev_type在同一个节点上会相互影响吗？

**在同一个节点上是什么意思？**

比如说一个层级布局中A的dev_net大于B的dev_net，但A的dev_type小于B的dev_type，此时要进行层级布局，那么A和B谁在上方

**可以简单的认为，A在上方，因为dev_net的优先级比较高**

是不是就是说 不只会有根据dev_type字段进行层级布局的需求 还会有根据dev_net和dev_type两种字段共同作用布局的需求，举个例子一个大层级布局展示里，上两层是169骨干网，中两层是A网，下面几层是城域网这种

**对，至少目前的布局，都是按这个逻辑来的**

**基本就这两个字段**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6a0b8169-8e06-4990-a8d7-7a8332fcba06/Untitled.png)

这图上呈现的这两个布局是将dev_net分开后，只根据dev_type呈现的吗？

**对，可以这样理解**

恩恩 好的 谢谢学长 我先想想怎么根据这种规则去处理数据以应用默认层级布局 如果不行的话再另实现一套算法

**好的，不客气，你先研究下吧**

**后边我有时间了给你整理下分级的规则，可以参考**

恩恩 好的